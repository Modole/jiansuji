# 谐波减速机测试系统（三页版）说明文档

本说明文档用于明确本项目的页面结构、测试功能范围、数据模型、接口约定与前端实现方案。基于现有资料（《谐波减速机测试系统操作方案(1).docx》《测试报告稿模板.xlsx》《通讯地址列表.xlsx》），先完成产品说明与前端原型，数据采集暂不实现，仅对接一个 POST 接口以获取实时 JSON 数据。

## 一、目标与范围
- 目标：将谐波减速机测试系统核心内容以三页形式呈现，支持实时数据展示与基础记录（前端侧），为后续数据采集与报表生成打基础。
- 范围：
  - 页面一：菜单与跳转（首页导航）。
  - 页面二：静态系统四项功能展示：
    1) 单向传动误差（arcmin）
    2) 空程（arcmin）
    3) 背隙（arcmin）
    4) 扭转刚度（N·m/deg 或 N·m/rad）
  - 页面三：动态/性能类六项功能展示：
    1) 启动转矩检测（N·m）
    2) 空载传动精度检测（arcmin）
    3) 变载荷传动精度检测（arcmin，含载荷等级）
    4) 峰值载荷传动精度检测（arcmin）
    5) 传动效率检测（%）
    6) 噪声测试检测（dB(A)）
- 不在范围：
  - 真实采集控制逻辑、设备联调。
  - 报表自动生成与完整测试流程管控（后续可扩展）。

## 二、数据与接口
- 数据来源：暂以 `POST http://127.0.0.1:1880/get/datas` 获取实时 JSON（可由 Node-RED 或自建网关输出）。
- 参考点位：`通讯地址列表.xlsx`（提供各测点通讯地址/寄存器）。本前端使用一个点位映射文件统一管理（见下文）。
- 接口调用方式：
  - 方法：`POST`
  - Headers：`Content-Type: application/json`
  - Body（可选）：前端可发送当前页面所需的点位 key 列表，网关据此返回对应数据；若网关不需要，也可发送空对象。
- 预期返回 JSON（建议格式，便于前端统一处理）：
```json
{
  "timestamp": "2025-01-01T12:00:00.000Z",
  "values": {
    "unidirectional_error": {"addr": "D1001", "value": 0.03, "unit": "arcmin"},
    "lost_motion": {"addr": "D1002", "value": 0.02, "unit": "arcmin"},
    "backlash": {"addr": "D1003", "value": 0.01, "unit": "arcmin"},
    "torsional_stiffness": {"addr": "D1004", "value": 12.3, "unit": "N·m/deg"},

    "start_torque": {"addr": "D2001", "value": 0.45, "unit": "N·m"},
    "no_load_accuracy": {"addr": "D2002", "value": 0.05, "unit": "arcmin"},
    "variable_load_accuracy": {"addr": "D2003", "value": 0.08, "unit": "arcmin", "load_level": 50},
    "peak_load_accuracy": {"addr": "D2004", "value": 0.09, "unit": "arcmin"},
    "transmission_efficiency": {"addr": "D2005", "value": 92.1, "unit": "%"},
    "noise_level": {"addr": "D2006", "value": 62.4, "unit": "dB(A)"}
  }
}
```
- 兼容性处理：若后台返回数组或不同字段命名，前端会做归一化（按 `values` 或 `points`/`data` 等常见结构自动适配）。
- CORS：如跨域限制需在 Node-RED 或网关开启 CORS 允许 `http://127.0.0.1:5500` 等前端来源。

## 三、点位映射（前端配置）
- 文件：`config/points-mapping.json`
- 用途：将业务逻辑 key（如 `unidirectional_error`）映射到 `通讯地址列表.xlsx` 中的通讯地址，便于前端发起请求与展示。
- 示例（初始化占位，需基于 `通讯地址列表.xlsx` 填写真实地址）：
```json
{
  "unidirectional_error": "ADDR_UNI_ERROR",
  "lost_motion": "ADDR_LOST_MOTION",
  "backlash": "ADDR_BACKLASH",
  "torsional_stiffness": "ADDR_TORSIONAL_STIFFNESS",

  "start_torque": "ADDR_START_TORQUE",
  "no_load_accuracy": "ADDR_NO_LOAD_ACC",
  "variable_load_accuracy": "ADDR_VAR_LOAD_ACC",
  "peak_load_accuracy": "ADDR_PEAK_LOAD_ACC",
  "transmission_efficiency": "ADDR_EFFICIENCY",
  "noise_level": "ADDR_NOISE"
}
```
- 维护建议：
  - 将 Excel 的测点“名称/地址/单位”对齐到上述 key；
  - 有多个子测点（如变载荷）可使用结构化 key：`variable_load_accuracy_L50`、`_L100` 等。

## 四、页面与UI设计
- 页面一（首页/菜单+跳转）：
  - 标题与系统概述。
  - 两个主入口卡片：静态系统、动态系统。
  - 显示接口连接状态与最近一次更新的时间戳。

- 页面二（静态系统四项）：
  - 四张卡片分别显示：当前值、单位、更新时间。
  - 操作：手动刷新、自动刷新开关（如每 1s/2s）。
  - 记录开关（前端内存队列），便于后续导出。

- 页面三（动态系统六项）：
  - 六张卡片显示当前值与单位（可扩展为曲线/峰值标注）。
  - 变载荷传动精度支持显示当前载荷等级（如 `load_level`）。
  - 操作：手动刷新、自动刷新开关、记录开关。

- 视觉与布局：
  - 响应式布局，卡片网格排布，顶部导航切换。
  - 提示色：绿色（正常）、橙色（注意）、红色（异常），阈值后续可配置。

## 五、前端工程结构
```
jiansuji/
├─ docs/
│  └─ 说明文档.md
├─ webapp/
│  ├─ index.html
│  ├─ styles.css
│  ├─ app.js
│  └─ config/
│     └─ points-mapping.json
```

## 六、实现要点
- 路由：使用 `hash` 路由（`#home`、`#static`、`#dynamic`）。
- 接口：封装 `fetchPostJson(url, payload)`，失败时使用本地 Mock（随机数据）以保证页面可用。
- 数据模型：统一归一化为 `{ timestamp, values: { key: { addr, value, unit, ... } } }`。
- 刷新策略：手动点击刷新 + 自动刷新（setInterval），支持停止。
- 记录策略：只在前端内存暂存最近 N 条（如 300 条），后续再扩展导出功能。

## 七、运行与预览
- 启动方式：使用本地静态服务器（如 `npx http-server` 或 `npx serve`），在 `webapp` 目录启动，端口建议 `5500`。
- 访问：`http://127.0.0.1:5500/`。
- 注意：若没有 Node 环境，可换用其他静态服务器；预览需确保接口地址可达。

## 八、后续扩展建议
- 报表：对接《测试报告稿模板.xlsx》字段，生成测试结果报表（Excel 或 PDF）。
- 测试流程：根据《操作方案(1).docx》细化步骤、判据、阈值与异常流程，加入前端流程管控。
- 校准与标定：加入标定参数管理与版本记录。
- 用户与权限：添加角色权限与操作审计。

## 九、与资料的对应关系（简述）
- 《谐波减速机测试系统操作方案(1).docx》：说明测试方法与流程，前端以模块化呈现各测试项，后续可把流程控件加到页面三。
- 《测试报告稿模板.xlsx》：定义报表结构与字段命名，当前先展示测量项与单位，后续对接导出。
- 《通讯地址列表.xlsx》：提供测点通讯地址，前端通过 `points-mapping.json` 映射至接口请求与展示。